<!DOCTYPE html>
<html lang="pt-BR">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <meta http-equiv="X-UA-Compatible" content="ie=edge">
   <link rel="stylesheet" href="index.css">
   <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
   <title>IA</title>
</head>

<body class="bg-dark">
   <div class="container-fluid">
      <div class="row bg-secondary">
         <div class="col-sm-1">
            <button onclick="core()" id="btnPlay" class="btn btn-dark w-100">Jogar</button>
         </div>
         <div class="col-sm">
            <span id="pontos">0</button>
         </div>
      </div>
      <div class="row">
         <div class="col-sm" id="divGame">

         </div>
      </div>
   </div>

</body>
<script>
   createtableGame();
   window.addEventListener("keydown", directionSnake, false);

   direction = 'r';
   qtdQuadro = 10;
   pontos = 0;
   sa = [[1, 0], [0, 0]];

   function createtableGame(qtdQuadro = 10) {
      let divGame = document.getElementById('divGame');

      let table = document.createElement('table');
      table.setAttribute('id', 'tableGame');
      table.setAttribute('cellspacing', '0px');
      table.setAttribute('border', '1px');

      for (let y = 0; y < qtdQuadro; y++) {
         let tr = document.createElement('tr');
         for (let x = 0; x < qtdQuadro; x++) {
            let td = document.createElement('td');
            td.style.padding = '7px';
            td.setAttribute('px', x);
            td.setAttribute('py', y);
            td.setAttribute('tipo', 'floor');
            tr.appendChild(td);
         }
         table.appendChild(tr);
      }
      divGame.appendChild(table);
   }

   function startGame(gera = false) {
      let tds = document.querySelectorAll('td');

      for (let i = 0; i < tds.length; i++) {
         if (tds[i].getAttribute('tipo') != 'food') {
            tds[i].style.background = '#343a40';
            tds[i].setAttribute('tipo', 'floor');
         }
      }

      for (let i = 0; i < sa.length; i++) {
         let snake = document.querySelector('[px="'+sa[i][0]+'"][py="'+sa[i][1]+'"]');
         snake.style.background = 'blue';
         snake.setAttribute('tipo', 'snake');
      }

      if (gera == true) {
         randomFood();//gera a "comida em algum lugar da tabela"
      }
   }

   function directionSnake(e) {
      switch (e.keyCode) {
         case 37:
            if (direction != 'r') {
               direction = 'l'
            }
            break;
         case 38:
            if (direction != 'd') {
               direction = 'u';
            }
            break;
         case 39:
            if (direction != 'l') {
               direction = 'r';
            }
            break;
         case 40:
            if (direction != 'u') {
               direction = 'd';
            }
            break;
      }
   }

   function randomFood() {
      let pBug = [Math.floor(Math.random() * qtdQuadro), Math.floor(Math.random() * qtdQuadro)];

      let bug = document.querySelector('[px="' + pBug[0] + '"][py="' + pBug[1] + '"]');

      if (bug.getAttribute(['tipo']) != 'snake') {
         bug.style.background = 'red';
         bug.setAttribute('tipo', 'food');
      }else{
         randomFood();
      }
   }

   function endgame(snake) {
      if (snake == null) {
         let btn = document.getElementById('btnPlay');
         btn.removeAttribute('disabled');
         clearInterval(loopcore);
         alert('voce perdeu');
         return false;
      } else {
         return true;
      }
   }

   function core() {
      let btn = document.getElementById('btnPlay');
      btn.setAttribute('disabled', 'disabled');
      startGame(true);
      let gera = false;
      loopcore = setInterval(() => {
         let pX = 0;
         let pY = 0;
         let snake = '';
         switch (direction) {
            case 'l':
               pX = parseInt(sa[0][0] -1);
               pY = parseInt(sa[0][1]);
               snake = document.querySelector('[px="' + pX + '"][py="' + pY + '"]');
               break;
            case 'u':
               pX = parseInt(sa[0][0]);
               pY = parseInt(sa[0][1] - 1);
               snake = document.querySelector('[px="' + pX + '"][py="' + pY + '"]');
               break;
            case 'r':
               pX = parseInt(sa[0][0] + 1);
               pY = parseInt(sa[0][1]);
               snake = document.querySelector('[px="' + pX + '"][py="' + pY + '"]');
               break;
            case 'd':
               pX = parseInt(sa[0][0]);
               pY = parseInt(sa[0][1]) + 1;
               snake = document.querySelector('[px="' + pX + '"][py="' + pY + '"]');
               break;
         }

         if (endgame(snake) == true) {
            if (snake.getAttribute("tipo") == 'food') {
               snake.setAttribute('tipo', 'snake');
               snake.style.background = 'blue';
               sa.unshift([pX, pY]);

               gera = true;
               pontos++;
               document.getElementById("pontos").innerHTML = pontos;
            } else if (snake.getAttribute("tipo") == 'snake') {
               let btn = document.getElementById('btnPlay');
               btn.removeAttribute('disabled');
               clearInterval(loopcore);
               alert('voce perdeu');
            }else{
               gera = false;
            }

         }


         if (gera == false) {//verifica se comeu
            for (let i = sa.length -1; i > 0; i--) {
               sa[i][0] = sa[i-1][0];
               sa[i][1] = sa[i-1][1];

               sa[0][0] = pX;
               sa[0][1] = pY;
            }
         }


         startGame(gera);

      }, 200);
   }

</script>

</html>