<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <title>IA</title>
</head>

<body>
    <div class="container-fluid">
        <div class="row bg-primary">
            <div class="col-sm-2">
                <span>Nome</span><br>
                <input type="text" class="form-control form-control-sm" id="nome">
            </div>
            <div class="col-sm-1 bg-success">
                <button onclick="core()" class="btn btn-dark w-100 mt-3">Jogar</button>
            </div>
        </div>
    </div>
    <div id="divGame">

    </div>
</body>
<script>
    createtableGame();

    direction = 'r';
    arraySnake = [0.0];

    function createtableGame(qtdQuadro = 20) {
        let divGame = document.getElementById('divGame');

        let table = document.createElement('table');
        // table.setAttribute('cellpadding', '5px');
        table.setAttribute('id', 'tableGame');
        table.setAttribute('cellspacing', '0px');
        table.setAttribute('border', '1px');

        for (let y = 0; y < qtdQuadro; y++) {
            let tr = document.createElement('tr');
            for (let x = 0; x < qtdQuadro; x++) {
                let td = document.createElement('td');
                // td.style.background = 'rgb('+ Math.floor(Math.random() * 255) +', '+ Math.floor(Math.random() * 255) +', '+ Math.floor(Math.random() * 255) +')';
                td.style.padding = '7px';
                td.setAttribute('px', x);
                td.setAttribute('py', y);
                tr.appendChild(td);
            }
            table.appendChild(tr);
        }
        divGame.appendChild(table);
    }

    function startGame() {
        tdP = document.querySelector('[px="0"][py="0"]');
        tdP.style.background = 'blue';
        tdP.setAttribute('class', 'snake');

        window.addEventListener("keydown", directionSnake, false);
    }

    function directionSnake(e) {
        switch (e.keyCode) {
            case 37:
                //left
                direction = 'l'
                break;
            case 38:
                //up
                direction = 'u';
                break;
            case 39:
                //right
                direction = 'r';
                break;
            case 40:
                //down
                direction = 'd';
                break;
        }
    }

    function removeSnake() {
        let campos = document.querySelectorAll('td');
        for (let i = 0; i < campos.length; ++i) {
            campos[i].style.background = 'white';
            campos[i].removeAttribute('class');
        }
    }
    function endgame(snake){
        if (snake == null) {
            clearInterval(loopcore);
            alert('voce perdeu');
            return false;
        }else{
            return true;
        }
    }

    function core(){
        removeSnake();
        startGame();
        direction = 'r';
        loopcore = setInterval(() => {
            let snake = document.querySelector('.snake');
            let pX = parseFloat(snake.getAttribute('px'));
            let pY = parseFloat(snake.getAttribute('py'));

            switch (direction) {
                case 'l':
                    newPos = document.querySelector('[px="'+(pX-1)+'"][py="'+pY+'"]');
                    if (endgame(newPos) == true){
                        removeSnake();
                        newPos.setAttribute('class', 'snake');
                        newPos.style.background = 'blue';
                    }
                    break;
                case 'u':
                    newPos = document.querySelector('[px="' + pX + '"][py="' + (pY - 1) + '"]');
                    if (endgame(newPos) == true) {
                        removeSnake();
                        newPos.setAttribute('class', 'snake');
                        newPos.style.background = 'blue';
                    }
                    break;
                case 'r':
                    newPos = document.querySelector('[px="' + (pX + 1) + '"][py="' + pY + '"]');
                    if (endgame(newPos) == true) {
                        removeSnake();
                        newPos.setAttribute('class', 'snake');
                        newPos.style.background = 'blue';
                    }
                    break;
                case 'd':
                    newPos = document.querySelector('[px="' + pX + '"][py="' + (pY + 1) + '"]');
                    if (endgame(newPos) == true) {
                        removeSnake();
                        newPos.setAttribute('class', 'snake');
                        newPos.style.background = 'blue';
                    }
                    break;
            }

        }, 1000);
    }

</script>

</html>